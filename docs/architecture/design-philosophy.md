# 設計哲学

> architect エージェントが構造評価・配置判断時に参照する設計原則。

## 設計哲学

### ペースレイヤリング（Pace Layering）

システムの各層は**変化の速度（Rate of Change）**が異なる。
速く変わる層が遅い層に依存するのは自然だが、逆は構造的欠陥となる。

```
変化が遅い ←――――――――――――――――→ 変化が速い

  インフラ   ドメインモデル   ビジネスロジック   UI/API   設定/テーマ
  ─────────────────────────────────────────────────────────────
  ほぼ不変    年単位で変化    月〜週で変化     日〜時間   即座に変更可
```

#### 判断基準

| 原則 | 説明 |
|---|---|
| **依存方向** | 速い層 → 遅い層への依存のみ許容。逆方向は禁止 |
| **安定度** | 変化が遅い層ほど抽象的・安定的であるべき |
| **境界の明確さ** | 各層の境界はインターフェースで明示する |
| **置換可能性** | 速い層は遅い層に影響を与えずに差し替え可能であるべき |

### 非機能要求の構造的満たしやすさ

アーキテクチャは非機能要求を**構造で実現する**。後からの付け足しではなく、
設計段階で構造に組み込む。

| 非機能要求 | 構造的アプローチ |
|---|---|
| **スケーラビリティ** | ステートレス設計、水平分割可能な境界 |
| **可用性** | 障害分離境界、フォールバック経路の確保 |
| **保守性** | 変更頻度の低い層への依存集中、高凝集・疎結合 |
| **テスタビリティ** | 依存の注入可能性、副作用の分離 |
| **セキュリティ** | 信頼境界の明示、最小権限の構造的強制 |
| **パフォーマンス** | ホットパスの明確化、キャッシュ層の配置 |

### データの流れ（Data Flow）

データがシステム内をどう流れるかは、構造の健全性を測る重要な指標である。

#### 評価観点

- **単方向性**: データの流れは原則として単方向であるべき。双方向の流れは結合度を高める
- **変換の局所性**: データ変換は明示的な境界点で行い、暗黙の変換を散在させない
- **所有権の明確さ**: 各データの正規化された所有者（Source of Truth）が1箇所に定まっている
- **伝搬の予測可能性**: ある変更がどのデータにどう波及するかを構造から推論できる

